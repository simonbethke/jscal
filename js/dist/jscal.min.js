(function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o}})(),define("class",["jquery"],function(e){return function(){var t,n;return t||e.Class}}(this)),define("classes/jscal/ApiInterface",["class"],function(e){var t=e.extend({getEvents:function(e){}});return t}),define("classes/jscal/EventRenderer",["jquery","class"],function(e,t){var n=t.extend({init:function(e){var t={timemodel:e.timeModel,targetNode:e.nodes.root,marginPixel:12,marginPercent:null};this.get=function(e){return t[e]},this.set=function(e,n){return t[e]=n}},getMargin:function(){if(this.get("marginPercent")==null){var e=this.get("marginPixel"),t=this.get("targetNode");this.set("marginPercent",{width:e/t.width(),height:e/t.height()})}return this.get("marginPercent")},render:function(t){var n=this.get("timemodel").getBoxes(t.get("period")),r="key"+t.get("key"),i=this.get("targetNode"),s=e("<div class='event "+r+"'>"+t.get("name")+"</div>");i.find("."+r).each(function(t,n){e(n).remove()});for(var o=0;o<n.positions.length;o++){var u=n.positions[o];this.calculateParallelPosition(u,t);var a=s.clone();a.css({position:"absolute",left:u.x*100+"%",top:u.y*100+"%",width:u.width*100+"%",height:u.height*100+"%",backgroundColor:t.get("color"),zIndex:t.get("zIndex")}),n.positions.length==1&&!n.cut.start&&!n.cut.end?a.addClass("fullCap"):o==0&&!n.cut.start?a.addClass("startCap"):o==n.positions.length-1&&!n.cut.end?a.addClass("endCap"):a.addClass("noCap");var f=o==n.positions.length-1&&!n.cut.end;this.extendBoxNode(t,a,f),i.append(a)}},extendBoxNode:function(e,t,n){},calculateParallelPosition:function(e,t){this.get("timemodel").get("horizontalEvents")?(e.height-=this.getMargin().height,e.height/=t.get("parallel").count,e.y+=this.getMargin().height+e.height*t.get("parallel").index):(e.width-=this.getMargin().width,e.width/=t.get("parallel").count,e.x+=this.getMargin().width+e.width*t.get("parallel").index)}});return n}),function(e,t){typeof module=="object"&&module.exports&&typeof require=="function"?module.exports=t():typeof define=="function"&&typeof define.amd=="object"?define("log",t):e.log=t()}(this,function(){function r(e){return typeof console===n?!1:console[e]!==undefined?i(console,e):console.log!==undefined?i(console,"log"):t}function i(e,t){var n=e[t];if(typeof n.bind=="function")return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(t,r){return function(){typeof console!==n&&(u(r),e[t].apply(e,arguments))}}function u(n){for(var r=0;r<o.length;r++){var i=o[r];e[i]=r<n?t:e.methodFactory(i,n)}}function a(e){var t=(o[e]||"silent").toUpperCase();try{window.localStorage.loglevel=t;return}catch(n){}try{window.document.cookie="loglevel="+t+";"}catch(n){}}function f(){var t;try{t=window.localStorage.loglevel}catch(r){}if(typeof t===n)try{t=/loglevel=([^;]+)/.exec(window.document.cookie)[1]}catch(r){}e.levels[t]===undefined&&(t="WARN"),e.setLevel(e.levels[t])}var e={},t=function(){},n="undefined",o=["trace","debug","info","warn","error"];e.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},e.methodFactory=function(e,t){return r(e)||s(e,t)},e.setLevel=function(t){typeof t=="string"&&e.levels[t.toUpperCase()]!==undefined&&(t=e.levels[t.toUpperCase()]);if(!(typeof t=="number"&&t>=0&&t<=e.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;a(t),u(t);if(typeof console===n&&t<e.levels.SILENT)return"No console available for logging"},e.enableAll=function(){e.setLevel(e.levels.TRACE)},e.disableAll=function(){e.setLevel(e.levels.SILENT)};var l=typeof window!==n?window.log:undefined;return e.noConflict=function(){return typeof window!==n&&window.log===e&&(window.log=l),e},f(),e}),define("classes/jscal/JSCal",["jquery","class","classes/jscal/EventRenderer","log"],function(e,t,n,r){var i=t.extend({nodes:{},timeModel:null,cellLabelSetup:null,eventRenderers:null,weekendDays:null,resourceKey:null,init:function(t){this.nodes={grid:e("<div class='grid'></div>")},t.rootNodeId?this.nodes.root=e("#"+t.rootNodeId):t.rootNode&&(this.nodes.root=t.rootNode),this.weekendDays=t.weekendDays,this.nodes.root.append(this.nodes.grid),this.timeModel=t.timeModel,this.eventRenderers={},this.cellLabelSetup={},this.addEventRenderer(this.getDefaultEventRenderer(this),["default"]),this.renderGrid(),this.resourceKey=t.resourceKey,r.info("JSCal has been initialized into DOM-Element with ID: "+t.rootNodeId)},getDefaultEventRenderer:function(e){return new n(e)},getResourceKey:function(){return this.resourceKey},setPeriod:function(e){this.timeModel.setPeriod(e),this.render()},getPeriod:function(){return this.timeModel.get("period")},getInputPane:function(){return this.nodes.inputPane||(this.nodes.inputPane=e("<div></div>"),this.nodes.inputPane.css({width:"100%",height:"100%",top:0,left:0,zIndex:100,position:"absolute"}),this.nodes.root.append(this.nodes.inputPane)),this.nodes.inputPane.css("display","block"),this.nodes.inputPane},disableInputPane:function(){this.nodes.inputPane.unbind(),this.nodes.inputPane.css("display","none")},addEventRenderer:function(e,t){for(var n=0;n<t.length;n++)this.eventRenderers[t[n]]=e},addEventRendererClass:function(e,t){var n=new e(this);this.addEventRenderer(n,t)},renderEvent:function(e){e.get("eventType")&&this.eventRenderers[e.get("eventType")]?this.eventRenderers[e.get("eventType")].render(e):this.eventRenderers.default.render(e)},render:function(){this.renderGrid(),this.renderOutterLabels(!0),this.renderOutterLabels(!1),this.nodes.root.find(".event").each(function(e,t){t.remove()})},renderGrid:function(){this.nodes.root.addClass(this.timeModel.get("horizontalEvents")?"eventsHorizontal":"eventsVertical");var e=this.timeModel.getSplitCount(),t=this.timeModel.getGridCount();this.nodes.grid.empty();var n=this.timeModel.get("period").getStart();for(var r=0;r<e;r++)for(var i=0;i<t;i++){var s=!1;this.weekendDays!=null&&(s=this.weekendDays[(new Date(n)).getUTCDay()]);var o;this.cellLabelSetup&&this.cellLabelSetup.inner&&this.cellLabelSetup.inner.label?o=this.createCellNode(this.cellLabelSetup.inner.label.generate(n),s,n):o=this.createCellNode("",s,n),this.timeModel.get("horizontalEvents")?o.css({position:"absolute",left:i/t*100+"%",top:r/e*100+"%",width:1/t*100+"%",height:1/e*100+"%"}):o.css({position:"absolute",left:r/e*100+"%",top:i/t*100+"%",width:1/e*100+"%",height:1/t*100+"%"}),this.nodes.grid.append(o),n+=this.timeModel.get("gridMillis")}},pageXYToTime:function(e){var t=(e.pageX-this.nodes.root.offset().left)/this.nodes.root.width(),n=(e.pageY-this.nodes.root.offset().top)/this.nodes.root.height();return this.timeModel.snapTime(this.timeModel.getTimeForPosition(t,n))},setLabels:function(e){this.cellLabelSetup=e,e.inner&&this.renderGrid(),e.outterGrid&&this.renderOutterLabels(!0),e.outterSplit&&this.renderOutterLabels(!1)},renderOutterLabels:function(t){if(!this.cellLabelSetup)return;if(t&&!this.cellLabelSetup.outterGrid)return;if(!t&&!this.cellLabelSetup.outterSplit)return;this.cellLabelSetup.topNodeId&&(this.cellLabelSetup.topNode=e("#"+this.cellLabelSetup.topNodeId)),this.cellLabelSetup.leftNodeId&&(this.cellLabelSetup.leftNode=e("#"+this.cellLabelSetup.leftNodeId));var n=this.timeModel.get("horizontalEvents"),r=this.timeModel.get("splitDuration"),i=this.timeModel.get("period"),s=this.timeModel.get("gridMillis"),o;n==t?o=this.cellLabelSetup.topNode:o=this.cellLabelSetup.leftNode;if(o.length==0)return;o.empty(),o.css("position","relative");var u=i.getStart(),a=t?s:r,f=t?r/a:i.getDuration()/a,l=100/r*s,c=100/i.getDuration()*r;for(var h=0;h<f;h++){var p=t?this.createCellNode(this.cellLabelSetup.outterGrid.label.generate(u)):this.createCellNode(this.cellLabelSetup.outterSplit.label.generate(u));n==t?p.css({position:"absolute",left:h/f*100+"%",top:0,width:(t?c:l)+"%"}):p.css({position:"absolute",left:0,top:h/f*100+"%",height:(t?l:c)+"%"}),o.append(p),u+=a}},createCellNode:function(t,n,r){if(r!=undefined)var i=e("<div xdata-resource-key='"+this.resourceKey+"' xdata-jcal-timestamp='"+r+"' class='cell clickable'></div>");else var i=e("<div xdata-resource-key='"+this.resourceKey+"' xdata-jcal-timestamp='"+r+"' class='cell'></div>");return n&&i.addClass("weekend"),typeof t=="string"?i.append(t):i.append(t),i}});return i}),define("classes/jscal/Period",["class"],function(e){var t=e.extend({init:function(e,t){isNaN(e)?this.initObject(e):this.initObject({start:e,end:t})},initObject:function(e){var t={start:e.start,end:e.end,duration:e.duration};this.modify=function(e){e(t)},this.get=function(e,n){return t[e]==null&&n(t),t[e]}},getStart:function(){return this.get("start")},setStart:function(e){this.modify(function(t){t.start=e,t.duration=null})},setEnd:function(e){this.modify(function(t){t.end=e,t.duration=null})},getEnd:function(){return this.get("end",function(e){e.end=e.start+e.duration})},getDuration:function(){return this.get("duration",function(e){e.duration=e.end-e.start})},shift:function(e){return this.modify(function(t){t.start+=e,t.end&&(t.end+=e)}),this},offset:function(e,t){var n=this.getEnd();return this.modify(function(r){r.start+=e,r.end=n+t,r.duration=null}),this},cage:function(e,t){var n=this.getStart(),r=this.getEnd();return this.modify(function(i){i.start=Math.max(e.getStart(),n),i.end=Math.min(e.getEnd(),r),t&&(t.start=i.start!=n,t.end=i.end!=r),i.duration=null}),this},clone:function(){return new t({start:this.getStart(),end:this.getEnd()})},equals:function(e){return this.getStart()==e.getStart()&&this.getEnd()==e.getEnd()}});return t}),define("classes/jscal/TimeModel",["class","classes/jscal/Period"],function(e,t){var n=e.extend({constDurations:[1e3,6e4,36e5,864e5,6048e5],period:null,settings:{},splitCount:1,init:function(e,t){var n={period:t,splitDuration:e.splitDurationMillis,splitCount:null,gridMillis:e.gridMillis!=undefined?e.gridMillis:36e5,gridCount:null,granularity:e.granularityMillis!=undefined?e.granularityMillis:1e3,horizontalEvents:e.horizontalEvents!=undefined?e.horizontalEvents:!0,startDayOfWeek:e.startDayOfWeek!=undefined?e.startDayOfWeek:1};this.get=function(e){return n[e]},this.set=function(e,t){n[e]=t},t!=undefined&&this.setPeriod(t)},setPeriod:function(e){this.set("period",e),this.get("splitDuration")||this.set("splitDuration",e.getDuration()),this.set("splitCount",null)},snapTime:function(e){var t=e-this.get("period").getStart();return e-t%this.get("granularity")},getSplitCount:function(){var e=this.get("splitCount");return e==null&&(e=this.get("period").getDuration()/this.get("splitDuration"),this.set("splitCount",e)),e},getGridCount:function(){var e=this.get("gridCount");return e==null&&(e=this.get("splitDuration")/this.get("gridMillis"),this.set("gridCount",e)),e},getTimeForPosition:function(e,t){var n=this.get("horizontalEvents"),r=n?t:e,i=n?e:t,s=this.get("splitDuration"),o=Math.floor(r*this.getSplitCount());return this.get("period").getStart()+s*o+s*i},getBoxes:function(e){var t=this.get("horizontalEvents"),n=this.get("period"),r=[],i={};e=e.clone().tzCage(n,i);if(e.getTzDuration()>0){var s=(this.snapTime(e.getTzStart())-n.getStart())/this.get("splitDuration"),o=(this.snapTime(e.getTzEnd())-n.getStart())/this.get("splitDuration"),u=Math.ceil(o)-Math.floor(s),a=Math.floor(s),f={barIndexPosition:0,barWidth:1/this.getSplitCount(),timePosition:s-Math.floor(s),timeLength:0};for(var l=0;l<u;l++)l==u-1&&o!=Math.floor(o)?f.timeLength=o-Math.floor(o):f.timeLength=1,f.timeLength-=f.timePosition,f.barIndexPosition=(l+a)/this.getSplitCount(),t?r[l]={x:f.timePosition,y:f.barIndexPosition,width:f.timeLength,height:f.barWidth}:r[l]={x:f.barIndexPosition,y:f.timePosition,width:f.barWidth,height:f.timeLength},f.timePosition=0}return{positions:r,cut:i}}});return n.MONTHLY={granularityMillis:36e5,horizontalEvents:!0,gridMillis:864e5,splitDurationMillis:6048e5},n.WEEKLY={granularityMillis:6e4,horizontalEvents:!1,gridMillis:36e5,splitDurationMillis:864e5},n.DAILY={granularityMillis:6e4,horizontalEvents:!1,gridMillis:36e5},n}),define("classes/jscal/LabelGenerator",["class"],function(e){var t=e.extend({init:function(e){if(e.generator){this.generate=e.generator;return}var t={methodName:e.dateProperty?"getUTC"+e.dateProperty:"toLocaleString",map:e.map};this.get=function(e){return t[e]}},generate:function(e){var t=this.get("map"),n=(new Date(e))[this.get("methodName")]();return t?t[n]:n}});return t}),define("classes/jscal/CalendarGenerator",["jquery","class","classes/jscal/JSCal","classes/jscal/EventRenderer","classes/jscal/TimeModel","classes/jscal/LabelGenerator","hogan"],function(e,t,n,r,i,s,o){var u=t.extend({events:null,controller:null,granularityMillis:null,renderers:null,init:function(e){this.events=e.events,this.controller=e.controller,this.weekendDays=e.weekendDays,this.granularityMillis=e.granularityMillis,this.controller.registerEventList(this.events),this.renderers=[{renderer:r,types:["taskEvent"]}]},calendarTemplate:"       <div class='jscal-wrapper'>         {{#top}}           <div class='labels top'></div>         {{/top}}         {{#left}}           <div class='labels left'></div>         {{/left}}         <div class='jscal'></div>       </div>",generateCalendar:function(t){var r=this.addDefaultsToConfig(t);this.compiledCalendarTemplate||(this.compiledCalendarTemplate=o.compile(this.calendarTemplate));var s=e(this.compiledCalendarTemplate.render(r.labels.enable)),u=s.find(".jscal");r.labels.enable.left&&u.addClass("hasLeftLabels");var a=new n({rootNode:u,timeModel:new i(r.timeModel,this.controller.period)});a.setLabels(this.createLabelConfig(r,s));for(var f=0;f<this.renderers.length;f++)a.addEventRendererClass(this.renderers[f].renderer,this.renderers[f].types);this.controller.registerCalendar(a,r.offset);for(var l=0;l<r.layers.length;l++)this.events.getEventLayer(r.layers[l]).registerCalendar(a);return r.target.append(s),a},addDefaultsToConfig:function(e){var t={target:e.target,timeModel:e.timeModel||{horizontalEvents:!1,gridMillis:36e5,splitDurationMillis:864e5},offset:e.offset||0,layers:e.layers||[],labels:e.labels||{enable:{top:!0,left:!0},outterGrid:{dateProperty:"Hours"},outterSplit:{dateProperty:"Day",map:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},inner:{dateProperty:"Date"}}};return t},createLabelConfig:function(e,t){var n={};return e.labels.outterGrid&&(n.outterGrid={label:new s(e.labels.outterGrid)}),e.labels.outterSplit&&(n.outterSplit={label:new s(e.labels.outterSplit)}),e.labels.inner&&(n.inner={label:new s(e.labels.inner)}),e.labels.enable.top&&(n.topNode=t.find(".labels.top")),e.labels.enable.left&&(n.leftNode=t.find(".labels.left")),n}});return u}),define("classes/jscal/EventCache",["class","log"],function(e,t){var n=e.extend({eventList:null,cachedPeriodTimes:null,apiInterface:null,requestStack:null,processActive:null,throbberNode:null,maxStackSize:3,init:function(e,t,n){this.eventList=e,this.apiInterface=t,this.throbberNode=n,this.cachedPeriodTimes=[],this.requestPeriodStack=[],this.processActive=!1},setActive:function(e){this.processActive=e,this.throbberNode&&(e?this.throbberNode.show():this.throbberNode.hide())},requestPeriod:function(e){this.requestPeriodStack.push(e),this.requestPeriodStack.length>this.maxStackSize&&this.requestPeriodStack.shift(),this.processActive||this.processRequestPeriodStack()},processRequestPeriodStack:function(){this.setActive(!0);var e=this.requestPeriodStack.pop(),n=e.period.clone();e.periodMarginFactor||(e.periodMarginFactor=1);var r=n.getDuration()*e.periodMarginFactor;n.offset(-1*r,r),t.debug("EventCache requested period is "+n.getStart()+" - "+n.getEnd());if(!e.refreshCache){var i;for(var s=0;s<this.cachedPeriodTimes.length;s++){i=this.cachedPeriodTimes[s];if(i.getEnd()>n.getStart()||i.getStart()<n.getEnd())if(i.getStart()<=n.getStart()&&i.getEnd()<n.getEnd())n.setStart(i.getEnd());else if(i.getStart()>n.getStart()&&i.getEnd()>=n.getEnd())n.setEnd(i.getStart());else if(i.getStart()<=n.getStart()&&i.getEnd()>=n.getEnd())return}}var o=this,e={period:n,success:function(e){o.requestComplete.apply(o,[e,n])},error:function(e){console.log("error: "+e)}};this.apiInterface.getEvents(e)},addPeriodToCachedPeriodTimes:function(e){this.cachedPeriodTimes[this.cachedPeriodTimes.length]=e;var t,n;for(var r=this.cachedPeriodTimes.length-1;r>=0;r--){t=this.cachedPeriodTimes[r];for(var i=r-1;i>=0;i--)n=this.cachedPeriodTimes[i],t.getEnd()>=n.getStart()&&t.getStart()<=n.getEnd()&&(n.setStart(Math.min(t.getStart(),n.getStart())),n.setEnd(Math.max(t.getEnd(),n.getEnd())),this.cachedPeriodTimes.splice(r,1))}},requestComplete:function(e,n){this.eventList.clearAndAddEvents(e,n),this.addPeriodToCachedPeriodTimes(n),this.requestPeriodStack.length>0?this.processRequestPeriodStack():(this.setActive(!1),t.debug("EventCache requests have been finished"))}});return n}),define("classes/jscal/EventLayer",["class","classes/jscal/Period"],function(e,t){var n=e.extend({init:function(e,t){var n={calendars:[],layerId:e,eventList:t};this.get=function(e){return n[e]}},getEvent:function(e){return this.get("eventList").getEventsByLayerId(this.get("layerId"))[e]},getEvents:function(){return this.get("eventList").getEventsByLayerId(this.get("layerId"))},renderLayer:function(){this.checkOverlapping();for(var e=0;e<this.getEvents().length;e++)this.renderEvent(this.getEvent(e))},renderToCalendar:function(e){for(var t=0;t<this.getEvents().length;t++)e.renderEvent(this.getEvent(t))},renderEvent:function(e){var t=this.get("calendars");for(var n=0;n<t.length;n++)t[n].renderEvent(e)},registerCalendar:function(e){return this.get("calendars").push(e),this},checkOverlapping:function(){this.getEvents().sort(function(e,t){return e.get("period").getTzStart()-t.get("period").getTzStart()});var e=[],t=[],n,r,i=0;for(var s=0;s<this.getEvents().length;s++){n=this.getEvent(s).get("period").getTzStart();for(var o=0;o<e.length;o++)e[o]&&e[o].get("period").getTzEnd()<=n&&(e[o]=null,i--);if(i==0){for(var u=0;u<t.length;u++)t[u].get("parallel").count=t.length-laneShares;t.length=0,e.length=0,laneShares=0}r=0;while(e[r])r++;r<e.length&&laneShares++,this.getEvent(s).get("parallel").index=r,i++,e[r]=this.getEvent(s),t[t.length]=this.getEvent(s)}for(var u=0;u<t.length;u++)t[u].get("parallel").count=t.length-laneShares}});return n}),define("classes/jscal/Node",["class"],function(e){var t=e.extend({init:function(){var e={parent:null,children:[]};this.treeGet=function(t){return e[t]},this.treeSet=function(t,n){e[t]=n}},setParent:function(e){e==this?this.treeSet("parent",null):(this.treeSet("parent",e),e!=null?this.addChild(this):this.removeChild(e,!0))},getParent:function(){return this.treeGet("parent")},addChild:function(e){e==this?this.treeGet("parent").treeGet("children").push(this):e.setParent(this)},removeChild:function(e,t){var n=this.treeGet("children"),r=0;if(sameObjInstance)while(r<n.length&&n[r]!=e)r++;else while(r<n.length&&!n[r].equals(e))r++;r<n.length&&(n.splice(r,1),e.setParent(e))},getChild:function(e){return this.treeGet("children")[e]},getChildCount:function(){return this.treeGet("children").length},forEach:function(e){for(var t=0;t<this.getChildCount();t++)e(this.getChild(t))}});return t}),define("classes/jscal/TimezonePeriod",["classes/jscal/Period","moment-timezone","log"],function(e,t,n){var r=e.extend({init:function(e){var n=this._super(e),i=e.tz?e.tz:{start:{localTimezone:e.startTimezone,timezone:e.startTimezone,millis:null},end:{localTimezone:e.endTimezone?e.endTimezone:e.startTimezone,timezone:e.endTimezone?e.endTimezone:e.startTimezone,millis:null},duration:{millis:null}};this.getMomentStart=function(){return t.tz(this.getStart(),i.start.timezone)},this.getMomentEnd=function(){return t.tz(this.getEnd(),i.end.timezone)},this.getMomentDuration=function(){return t.duration(this.getDuration())};var s=this.modify;this.modify=function(e){return i.start.millis=null,i.end.millis=null,i.duration.millis=null,s(function(t){return e(t,i)})},this.getTz=function(e,t){return i[e].millis==null&&t.apply(this,[i]),i[e].millis},this.clone=function(){var e=new r({start:this.getStart(),end:this.getEnd(),tz:$.extend(!0,{},i)});return e}},getTzStart:function(){return this.getTz("start",function(e){e.start.millis=this.getStart()-t.tz.zone(e.start.timezone).offset(this.getStart())*60*1e3})},getTzEnd:function(){return this.getTz("end",function(e){e.end.millis=this.getEnd()-t.tz.zone(e.end.timezone).offset(this.getEnd())*60*1e3})},getTzDuration:function(){return this.getTz("duration",function(e){e.duration.millis=this.getTzEnd()-this.getTzStart()})},humanize:function(){var e={date:"DD.MM.YYYY",time:"HH:mm",separator:" - "},t=this.getMomentStart(),n=this.getMomentEnd(),r=e.date+" "+e.time;if(this.displayTimezone){if(t.isSame(n,"day"))return t.format(e.date+" "+e.time)+e.separator+n.format(e.time);if(t.format("HHmmssSSS")=="000000000"&&n.format("HHmmssSSS")=="000000000")return t.format(e.date)+e.separator+n.format(e.date)}else r+=" z";return t.format(r)+e.separator+n.format(r)},tzCage:function(e,n){var r=this.getStart(),i=this.getEnd();return this.modify(function(s,o){var u=e.getStart()+t.tz.zone(o.start.timezone).offset(e.getStart())*60*1e3,a=e.getEnd()+t.tz.zone(o.end.timezone).offset(e.getEnd())*60*1e3;s.start=Math.max(u,r),s.end=Math.min(a,i),s.duration=null,n&&(n.start=s.start!=r,n.end=s.end!=i)}),this},setTimezone:function(e){this.displayTimezone=e,this.modify(function(t,n){e==null?(n.start.timezone=n.start.localTimezone,n.end.timezone=n.end.localTimezone):(n.start.timezone=e,n.end.timezone=e)}),n.trace("Displayed timezone was set to: "+e)}});return r}),define("classes/jscal/EventNode",["classes/jscal/Node","classes/jscal/TimezonePeriod"],function(e,t){var n=e.extend({init:function(e){this._super();var n={mutable:{name:e.name,color:e.color,period:e.timezonePeriod?e.timezonePeriod:new t({start:e.start,startTimezone:e.timezone,end:e.end}),properties:{},parallel:{}},immutable:{layerId:e.layerId,zIndex:e.zIndex,eventType:e.eventType,key:e.key}};this.get=function(e){return n.immutable[e]!=null?n.immutable[e]:n.mutable[e]},this.set=function(e,t){n.mutable[e]=t}},setTimezone:function(e){this.get("period").setTimezone(e)},getProperties:function(){return this.get("properties")},getPeriod:function(){return this.get("period")},equals:function(e){return this.get("period").equals(e.get("period"))&&this.get("name")==e.get("name")&&this.get("eventType")==e.get("eventType")&&this.get("color")==e.get("color")},clone:function(){var e=new n({name:this.get("name"),color:this.get("color"),timezonePeriod:this.get("period").clone(),layerId:this.get("layerId"),zIndex:this.get("zIndex"),eventType:this.get("eventType"),properties:{}});for(var t in this.getProperties())e.properties[t]=this.getProperties()[t];return e}});return n}),define("classes/jscal/EventList",["class","classes/jscal/Period","classes/jscal/EventNode","classes/jscal/EventLayer"],function(e,t,n,r){var i=e.extend({init:function(){var e={eventsByLayerId:[],eventLayers:[]},t={eventCache:null,timezone:null};this.getData=function(e){return t[e]},this.setData=function(e,n){t[e]=n},this.getListItem=function(t,n){return e[t][n]},this.setListItem=function(t,n,r){e[t][n]=r},this.addListItem=function(t,n){e[t].push(n)},this.forEachListItem=function(t,n){for(var r in e[t])n(e[t][r])}},getEventLayer:function(e){var t=this.getListItem("eventLayers",e);return t||(t=new r(e,this),this.setListItem("eventLayers",e,t)),t},getEventsByLayerId:function(e){var t=this.getListItem("eventsByLayerId",e);return t||(t=[],this.setListItem("eventsByLayerId",e,t)),t},setEventCache:function(e){this.setData("eventCache",e)},addEvent:function(e){return e.setTimezone(this.getData("timezone")),this.getEventsByLayerId(e.get("layerId")).push(e),e},addEvents:function(e){var t=[],r;for(var i=0;i<e.length;i++)r=this.addEvent(new n(e[i])),t[r.get("layerId")]=this.getEventLayer(r.get("layerId"));for(var s in t)t[s].renderLayer()},clearAndAddEvents:function(e,t){var n=this;this.forEachListItem("eventsByLayerId",function(e){for(var n=e.length-1;n>=0;n--)t.getStart()<e[n].getPeriod().getEnd()&&t.getEnd()>e[n].getPeriod().getStart()&&e.splice(n,1)}),this.addEvents(e)},setTimezone:function(e){this.setData("timezone",e),this.forEachListItem("eventsByLayerId",function(t){for(var n=0;n<t.length;n++)t[n].setTimezone(e)}),this.renderList()},renderList:function(){this.forEachListItem("eventLayers",function(e){e.renderLayer()})},loadPeriod:function(e){var t=this.getData("eventCache");t!=null&&t.requestPeriod({period:e,refreshCache:!0,periodMarginFactor:1}),this.forEachListItem("eventLayers",function(e){e.renderLayer()})}});return i}),define("classes/jscal/InputHandler",["class"],function(e){var t=e.extend({init:function(e){var t={calendar:e};this.get=function(e){return t[e]}},input:function(e){e.data.handler[e.type].apply(e.data,[e])},register:function(e){e.at.on(e.on,{calendar:this.get("calendar"),object:e.object,handler:this},this.input)},afterEventEdit:function(e){e.compilePeriodToUtc()}});return t}),define("classes/jscal/VisiblePeriodController",["class"],function(e){var t=e.extend({inputPeriod:null,period:null,calendars:null,eventLists:null,statusLabels:null,isMonthView:!0,init:function(e,t){this.calendars=[],this.eventLists=[],this.statusLabels=[],this.setPeriod(e),this.isMonthView=t},registerCalendar:function(e,t){this.calendars[this.calendars.length]={cal:e,offset:t?t:0},e.setPeriod(this.period.clone().shift(this.period.getDuration()*t))},getBiggestOffset:function(){var e=0;for(var t=0;t<this.calendars.length;t++)this.calendars[t].offset>e&&(e=this.calendars[t].offset);return e},registerEventList:function(e){this.eventLists.push(e),e.loadPeriod(this.period)},notifyCalendarsAndUpdateLocalPeriod:function(){var e,t;e=this.period;for(var n=0;n<this.calendars.length;n++){this.calendars[n].cal.setPeriod(this.period.clone().shift(this.period.getDuration()*this.calendars[n].offset));if(this.calendars[n].offset==0){t=this.calendars[n].cal.getPeriod();if(e.getStart()>t.getStart()||e.getEnd()<t.getEnd())e=t}}this.period=e},notifyEventLists:function(){var e=this.period.clone();e.setEnd(e.getStart()+e.getDuration()*(this.getBiggestOffset()+1));for(var t=0;t<this.eventLists.length;t++)this.eventLists[t].loadPeriod(e)},setPeriod:function(e){return this.inputPeriod=e,this.period=e,this.refresh(),this.period},refresh:function(){this.notifyCalendarsAndUpdateLocalPeriod(),this.notifyEventLists(),this.updateStatusAllLabels()},shiftPeriod:function(e){this.setPeriod(this.inputPeriod.shift(e))},addStatusLabel:function(e,t){var n={node:e,generator:t};this.statusLabels[this.statusLabels.length]=n,this.updateStatusLabel(n)},updateStatusAllLabels:function(){for(var e=0;e<this.statusLabels.length;e++)this.updateStatusLabel(this.statusLabels[e])},updateStatusLabel:function(e){var t=this.inputPeriod.getStart();e.node.text(e.generator.generate(t))},addNavigationClickEventHandler:function(e,t){e.click(this,function(e){e.data.setPeriod(t(e.data.inputPeriod))})},setTimezone:function(e){for(var t=0;t<this.eventLists.length;t++)this.eventLists[t].setTimezone(e)}});return t});